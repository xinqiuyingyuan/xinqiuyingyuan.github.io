<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="articleTitle">文章详情 - 信秋映鸢的个人博客</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Noto+Sans+SC:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --magic-purple: #6B46C1;
            --magic-gold: #F59E0B;
            --magic-dark: #1F2937;
            --magic-light: #F3F4F6;
            --text-dark: #1F2937;
            --text-gray: #6B7280;
        }
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #1F2937 0%, #374151 50%, #1F2937 100%);
            min-height: 100vh;
            margin: 0;
            padding-top: 80px;
            color: var(--text-dark);
        }
        
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--magic-gold);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(245, 158, 11, 0.2);
        }
        
        .nav-item {
            margin: 0 2rem;
            padding: 0.5rem 1rem;
            color: var(--magic-light);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            border-radius: 20px;
            position: relative;
        }
        
        .nav-item:hover {
            color: var(--magic-gold);
            transform: scale(1.05);
            background: rgba(245, 158, 11, 0.1);
        }
        
        .nav-item.active {
            color: var(--magic-gold);
            background: rgba(245, 158, 11, 0.2);
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 3px;
            background: var(--magic-gold);
            border-radius: 2px;
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: flex;
            gap: 2rem;
        }
        
        .sidebar {
            width: 250px;
            background: white;
            border-radius: 15px;
            border: 1px solid var(--magic-gold);
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(245, 158, 11, 0.2);
            height: fit-content;
            position: sticky;
            top: 80px;
        }
        
        .avatar-section {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid var(--magic-gold);
            margin: 0 auto 1rem;
            display: block;
            object-fit: cover;
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .social-link {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--magic-gold);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .social-link:hover {
            background: var(--magic-purple);
            transform: scale(1.1);
        }
        
        .content-area {
            flex: 1;
            background: white;
            border-radius: 15px;
            border: 1px solid var(--magic-gold);
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(245, 158, 11, 0.2);
        }
        
        .article-header {
            border-bottom: 2px solid var(--magic-gold);
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .article-title {
            font-family: 'Noto Serif SC', serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 1rem;
            line-height: 1.4;
        }
        
        .article-meta {
            display: flex;
            gap: 2rem;
            color: var(--text-gray);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .article-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--text-dark);
            margin-bottom: 2rem;
        }
        
        .article-content p {
            margin-bottom: 1.5rem;
        }
        
        .article-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: var(--magic-light);
            border-radius: 10px;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--magic-gold);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            background: var(--magic-purple);
            transform: translateY(-2px);
        }
        
        .action-btn.liked {
            background: #EF4444;
        }
        
        .comments-section {
            border-top: 2px solid var(--magic-gold);
            padding-top: 2rem;
        }
        
        .comments-title {
            font-family: 'Noto Serif SC', serif;
            font-size: 1.5rem;
            color: var(--text-dark);
            margin-bottom: 1.5rem;
        }
        
        .comment-form {
            background: var(--magic-light);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-weight: 500;
        }
        
        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--magic-gold);
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        .form-input:focus,
        .form-textarea:focus {
            border-color: var(--magic-purple);
            box-shadow: 0 0 0 3px rgba(107, 70, 193, 0.1);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .submit-btn {
            background: var(--magic-gold);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            background: var(--magic-purple);
            transform: translateY(-2px);
        }
        
        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .comment-item {
            background: var(--magic-light);
            border-radius: 10px;
            padding: 1.5rem;
            border-left: 4px solid var(--magic-gold);
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .comment-author {
            font-weight: 600;
            color: var(--magic-purple);
        }
        
        .comment-time {
            font-size: 0.85rem;
            color: var(--text-gray);
        }
        
        .comment-content {
            color: var(--text-dark);
            line-height: 1.6;
        }
        
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--magic-purple);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }
        
        .back-btn:hover {
            background: var(--magic-gold);
            transform: translateY(-2px);
        }
        
        #p5-canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
            pointer-events: none;
        }
        
        .content {
            position: relative;
            z-index: 2;
        }
        
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                padding: 1rem;
                gap: 1rem;
            }
            
            .sidebar {
                width: 100%;
                position: static;
            }
            
            .article-title {
                font-size: 1.5rem;
            }
            
            .article-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .article-actions {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar">
        <a href="index.html" class="nav-item">首页</a>
        <a href="articles.html" class="nav-item active">文章</a>
        <a href="study.html" class="nav-item">学习记录</a>
    </nav>

    <!-- p5.js 画布 -->
    <div id="p5-canvas"></div>

    <!-- 主要内容 -->
    <div class="content">
        <div class="main-container">
            <!-- 侧边栏 -->
            <aside class="sidebar">
                <div class="avatar-section">
                    <img src="./resources/marisa-avatar.jpg" alt="信秋映鸢" class="avatar">
                    <h3 style="color: var(--text-dark); margin: 0.5rem 0;">信秋映鸢</h3>
                    <p style="color: var(--text-gray); font-size: 0.9rem; margin: 0;">魔法使いの修行中</p>
                    
                    <div class="social-links">
                        <a href="https://github.com/xinqiuyingyuan" class="social-link" title="GitHub" target="_blank">
                            <img src="https://kimi-web-img.moonshot.cn/img/brand.github.com/9655220619dc35b92570c11fcb6b99343b5f1187.png" alt="GitHub" style="width: 20px; height: 20px; filter: invert(1);">
                        </a>
                        <a href="https://www.codefather.cn/user/1877736758767890434/info" class="social-link" title="编程导航" target="_blank">
                            <img src="https://kimi-web-img.moonshot.cn/img/cdn-icons-png.flaticon.com/24219fe0a0886827b4ce8f7fa2653da2d1d84d6b.png" alt="编程导航" style="width: 20px; height: 20px; filter: invert(1);">
                        </a>
                    </div>
                </div>
            </aside>

            <!-- 内容区域 -->
            <main class="content-area">
                <a href="articles.html" class="back-btn">
                    ← 返回文章列表
                </a>

                <!-- 文章头部 -->
                <article class="article-header">
                    <h1 class="article-title" id="articleDetailTitle">文章标题</h1>
                    <div class="article-meta">
                        <div class="meta-item">
                            📅 <span id="articleDate">2025-10-24</span>
                        </div>
                        <div class="meta-item">
                            🏷️ <span id="articleCategory">日常随笔</span>
                        </div>
                        <div class="meta-item">
                            👁️ <span id="articleViews">0</span> 阅读
                        </div>
                    </div>
                </article>

                <!-- 文章内容 -->
                <div class="article-content" id="articleDetailContent">
                    <!-- 文章内容将通过JavaScript动态加载 -->
                </div>

                <!-- 文章操作 -->
                <div class="article-actions">
                    <button class="action-btn" id="likeBtn" onclick="toggleLike()">
                        ❤️ <span id="likeCount">0</span>
                    </button>
                    <button class="action-btn" onclick="shareArticle()">
                        📤 分享
                    </button>
                    <button class="action-btn" onclick="printArticle()">
                        🖨️ 打印
                    </button>
                </div>

                <!-- 评论区 -->
                <section class="comments-section">
                    <h2 class="comments-title">💬 评论 (<span id="commentsCount">0</span>)</h2>
                    
                    <!-- 评论表单 -->
                    <form class="comment-form" id="commentForm" onsubmit="submitComment(event)">
                        <div class="form-group">
                            <label class="form-label">昵称 *</label>
                            <input type="text" class="form-input" id="commentName" placeholder="请输入您的昵称" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">邮箱 *</label>
                            <input type="email" class="form-input" id="commentEmail" placeholder="请输入您的邮箱" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">评论内容 *</label>
                            <textarea class="form-textarea" id="commentContent" placeholder="请输入您的评论..." required></textarea>
                        </div>
                        <button type="submit" class="submit-btn">发表评论</button>
                    </form>

                    <!-- 评论列表 -->
                    <div class="comments-list" id="commentsList">
                        <!-- 评论将通过JavaScript动态生成 -->
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>
        // 文章数据
        let currentArticle = null;
        let articleComments = [];

        // p5.js 魔法粒子效果
        let particles = [];
        let stars = [];
        
        function setup() {
            let canvas = createCanvas(windowWidth, windowHeight);
            canvas.parent('p5-canvas');
            
            // 初始化星星
            for (let i = 0; i < 50; i++) {
                stars.push({
                    x: random(width),
                    y: random(height),
                    size: random(1, 3),
                    alpha: random(0.3, 1),
                    twinkle: random(0.01, 0.03)
                });
            }
            
            // 初始化魔法粒子
            for (let i = 0; i < 20; i++) {
                particles.push({
                    x: random(width),
                    y: random(height),
                    size: random(4, 8),
                    alpha: random(0.3, 0.8),
                    speedX: random(-1, 1),
                    speedY: random(-1, 1),
                    color: random(['gold', 'purple', 'white'])
                });
            }
        }
        
        function draw() {
            clear();
            
            // 绘制星星背景
            for (let star of stars) {
                star.alpha += star.twinkle;
                if (star.alpha > 1 || star.alpha < 0.3) {
                    star.twinkle *= -1;
                }
                
                if (star.color === 'gold') {
                    fill(245, 158, 11, star.alpha * 255);
                } else if (star.color === 'purple') {
                    fill(107, 70, 193, star.alpha * 255);
                } else {
                    fill(255, 255, 255, star.alpha * 255);
                }
                
                noStroke();
                ellipse(star.x, star.y, star.size);
            }
            
            // 绘制魔法粒子
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                
                // 更新粒子位置
                p.x += p.speedX;
                p.y += p.speedY;
                p.alpha *= 0.98;
                
                // 边界检查
                if (p.x < 0 || p.x > width || p.y < 0 || p.y > height) {
                    particles.splice(i, 1);
                    continue;
                }
                
                // 绘制粒子
                if (p.color === 'gold') {
                    fill(245, 158, 11, p.alpha * 255);
                } else if (p.color === 'purple') {
                    fill(107, 70, 193, p.alpha * 255);
                } else {
                    fill(255, 255, 255, p.alpha * 255);
                }
                
                noStroke();
                ellipse(p.x, p.y, p.size);
                
                // 添加光晕效果
                fill(255, 255, 255, p.alpha * 100);
                ellipse(p.x, p.y, p.size * 2);
            }
            
            // 添加新粒子
            if (frameCount % 3 === 0 && particles.length < 30) {
                particles.push({
                    x: random(width),
                    y: random(height),
                    size: random(4, 8),
                    alpha: random(0.3, 0.8),
                    speedX: random(-1, 1),
                    speedY: random(-1, 1),
                    color: random(['gold', 'purple', 'white'])
                });
            }
        }
        
        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }

        // 加载文章详情
        function loadArticle() {
            // 从URL获取文章ID
            const urlParams = new URLSearchParams(window.location.search);
            const articleId = urlParams.get('id');
            
            if (!articleId) {
                // 如果没有文章ID，显示默认文章
                showDefaultArticle();
                return;
            }
            
            // 从localStorage或默认数据中获取文章
            const savedArticles = localStorage.getItem('blog_articles');
            let articles = [];
            
            if (savedArticles) {
                articles = JSON.parse(savedArticles);
            } else {
                // 默认示例文章
                articles = [
                    {
                        id: 1,
                        title: "魔法使いの日常",
                        excerpt: "今日も魔法の修行を頑張りました！",
                        content: `今日は朝から魔法の修行を始めました。まずは基本の魔力制御から始まり、午後には新しい魔法の呪文を勉強しました。

魔法って本当に面白いですね。毎日新しい発見があります。特に今日は星の魔法について深く学ぶことができて、とても充実した一日でした。

明日もまた頑張ろうと思います！`,
                        category: "daily",
                        date: "2025-10-24",
                        likes: 12,
                        comments: 3
                    }
                ];
            }
            
            currentArticle = articles.find(a => a.id == articleId);
            
            if (!currentArticle) {
                showDefaultArticle();
                return;
            }
            
            // 显示文章详情
            document.getElementById('articleDetailTitle').textContent = currentArticle.title;
            document.getElementById('articleDate').textContent = currentArticle.date;
            document.getElementById('articleCategory').textContent = getCategoryName(currentArticle.category);
            document.getElementById('articleViews').textContent = Math.floor(Math.random() * 100) + 50;
            document.getElementById('articleDetailContent').innerHTML = currentArticle.content.replace(/\n/g, '<br>');
            document.getElementById('likeCount').textContent = currentArticle.likes;
            
            // 更新页面标题
            document.getElementById('articleTitle').textContent = currentArticle.title + ' - 信秋映鸢的个人博客';
            
            // 加载评论
            loadComments();
        }
        
        function showDefaultArticle() {
            const defaultArticle = {
                id: 1,
                title: "魔法使いの日常",
                excerpt: "今日も魔法の修行を頑張りました！",
                content: `今日は朝から魔法の修行を始めました。まずは基本の魔力制御から始まり、午後には新しい魔法の呪文を勉強しました。

魔法って本当に面白いですね。毎日新しい発見があります。特に今日は星の魔法について深く学ぶことができて、とても充実した一日でした。

明日もまた頑張ろうと思います！`,
                category: "daily",
                date: "2025-10-24",
                likes: 12,
                comments: 3
            };
            
            currentArticle = defaultArticle;
            
            document.getElementById('articleDetailTitle').textContent = defaultArticle.title;
            document.getElementById('articleDate').textContent = defaultArticle.date;
            document.getElementById('articleCategory').textContent = getCategoryName(defaultArticle.category);
            document.getElementById('articleViews').textContent = Math.floor(Math.random() * 100) + 50;
            document.getElementById('articleDetailContent').innerHTML = defaultArticle.content.replace(/\n/g, '<br>');
            document.getElementById('likeCount').textContent = defaultArticle.likes;
            
            loadComments();
        }
        
        function getCategoryName(category) {
            const categoryNames = {
                'daily': '日常随笔',
                'study': '学习笔记',
                'beautiful': '美好记录'
            };
            return categoryNames[category] || '其他';
        }
        
        // 点赞功能
        function toggleLike() {
            if (!currentArticle) return;
            
            const likeBtn = document.getElementById('likeBtn');
            const likeCount = document.getElementById('likeCount');
            
            if (likeBtn.classList.contains('liked')) {
                currentArticle.likes--;
                likeBtn.classList.remove('liked');
            } else {
                currentArticle.likes++;
                likeBtn.classList.add('liked');
            }
            
            likeCount.textContent = currentArticle.likes;
            
            // 保存到localStorage
            const savedArticles = localStorage.getItem('blog_articles');
            if (savedArticles) {
                let articles = JSON.parse(savedArticles);
                const index = articles.findIndex(a => a.id === currentArticle.id);
                if (index !== -1) {
                    articles[index] = currentArticle;
                    localStorage.setItem('blog_articles', JSON.stringify(articles));
                }
            }
        }
        
        // 分享功能
        function shareArticle() {
            if (navigator.share) {
                navigator.share({
                    title: currentArticle.title,
                    text: currentArticle.excerpt,
                    url: window.location.href
                });
            } else {
                // 复制链接到剪贴板
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('链接已复制到剪贴板！');
                });
            }
        }
        
        // 打印功能
        function printArticle() {
            window.print();
        }
        
        // 加载评论
        function loadComments() {
            // 从localStorage加载评论
            const savedComments = localStorage.getItem(`article_${currentArticle.id}_comments`);
            if (savedComments) {
                articleComments = JSON.parse(savedComments);
            } else {
                // 初始化为空数组，不预设任何评论
                articleComments = [];
            }
            
            renderComments();
        }
        
        // 渲染评论
        function renderComments() {
            const commentsList = document.getElementById('commentsList');
            const commentsCount = document.getElementById('commentsCount');
            
            commentsCount.textContent = articleComments.length;
            
            commentsList.innerHTML = articleComments.map(comment => `
                <div class="comment-item">
                    <div class="comment-header">
                        <span class="comment-author">${comment.name}</span>
                        <span class="comment-time">${comment.time}</span>
                    </div>
                    <div class="comment-content">${comment.content}</div>
                </div>
            `).join('');
        }
        
        // 提交评论
        function submitComment(event) {
            event.preventDefault();
            
            const name = document.getElementById('commentName').value.trim();
            const email = document.getElementById('commentEmail').value.trim();
            const content = document.getElementById('commentContent').value.trim();
            
            if (!name || !email || !content) {
                alert('请填写所有必填字段！');
                return;
            }
            
            if (!email.includes('@') || !email.includes('.')) {
                alert('请输入有效的邮箱地址！');
                return;
            }
            
            const newComment = {
                id: Date.now(),
                name,
                email,
                content,
                time: new Date().toLocaleString('zh-CN')
            };
            
            articleComments.unshift(newComment);
            
            // 保存到localStorage
            localStorage.setItem(`article_${currentArticle.id}_comments`, JSON.stringify(articleComments));
            
            // 清空表单
            document.getElementById('commentForm').reset();
            
            // 重新渲染评论
            renderComments();
            
            alert('评论发表成功！');
        }
        
        // 页面加载完成后初始化
        window.addEventListener('load', () => {
            loadArticle();
            
            // 检查管理员状态
            if (localStorage.getItem('isAdmin') === 'true') {
                document.getElementById('adminLogoutBtn').classList.add('show');
            }
        });
    </script>
</body>
</html>